GFM-TOC
* [一、概述](#一概述)
    * [网络的网络](#网络的网络)
    * [互联网的组成](#互联网的组成)
    * [ISP](#ISP)
    * [主机之间的通信方式](#主机之间的通信方式)
    * [电路交换与分组交换](#电路交换与分组交换)
    * [计算机网络的类别](#计算机网络的类别)
    * [计算机网络的性能](#计算机网络的性能)
    * [计算机网络体系结构](#计算机网络体系结构)
* [二、物理层](#二物理层)
    * [物理层任务](#物理层任务)
    * [通信方式](#通信方式)
    * [信道复用技术](#信道复用技术)
* [三、数据链路层](#三数据链路层)
    * [信道分类](#信道分类)
    * [三个基本问题](#三个基本问题)
    * [PPP协议](#PPP协议)
    * [CSMA/CD协议](#CSMA/CD协议)
* [参考资料](#参考资料)
GFM-TOC


# 一、概述

## 网络的网络

计算机网络由若干 `结点` 和连接这些结点的 `链路` 组成。网络中的结点可以是计算机、集线器、交换机或路由器等。

网络把主机连接起来，而互联网是把多种不同的网络连接起来，因此互联网是网络的网络。

<img src='https://github.com/PDKSophia/read-booklist/raw/master/book-image/network/net-1.png' width=500>

## 互联网的组成
互联网可以划分为两大块: `边缘部分` 和 `核心部分`

#### 边缘部分
就是连接在互联网上的所有的主机，这些主机又称为 `端系统`，小的端系统可以是一台普通个人电脑和具有上网功能的智能手机，大的端系统是一台非常昂贵的大型计算机。*边缘部分利用核心部分所提供的服务，使众多主机之间能够互相通信并交换或共享信息*

明确一个概念 —— 主机A和主机B进行通信。

实际上是指: 运行在主机A上的某个程序和运行在主机B上的某个程序进行通信。由于“进程”就是“运行着的程序”，因此可以理解为: “主机A上的某个进程和主机B上的另一个进程进行通信”。

#### 核心部分
在核心部分起到特殊作用的是 `路由器`, 它是一种专用计算机。 路由器是实现 `分组交换` 的关键构件，其任务是 `转发收到的分组`

## ISP
互联网服务提供商 ISP 可以从互联网管理机构申请到许多 IP 地址，同时拥有通信线路 (大ISP自己建造通信线路，小ISP则向电信公司租用通信线路)以及路由器等连网设备，因此任何机构或个人只要向某个ISP缴纳规定的费用，就能从该ISP获取所需IP地址的使用权，并通过该ISP接入到互联网。

现在的互联网已经不再是单个组织所拥有而是全世界无数大大小小的ISP共同拥有的，这也就是为什么互联网也称为 "网络的网络" 的原因

## 主机之间的通信方式
- 客户服务器方式 ( C/S方式 ) : 客户是服务请求方，服务器是服务提供方

<img src='https://github.com/PDKSophia/read-booklist/raw/master/book-image/network/net-2.png' width=420>

- 对等连接方式 (P2P方式) : 两台主机在通信时不区分哪一个是服务器请求方哪一个是服务器提供方

<img src='https://github.com/PDKSophia/read-booklist/raw/master/book-image/network/net-3.png' width=420>

## 电路交换与分组交换
### 1. 电路交换
从通信资源分配角度来看，`交换`就是按照某种方式动态地分配传输线路的资源。电路交换用于电话通信系统，两个用户要通信之前需要建立一条`专用的物理链路`，并且在整个通信过程中始终占用该链路。由于通信的过程中不可能一直在使用传输线路，因此电路交换对线路的利用率很低，往往不到 10%。

电路交换的三个步骤 : “ 建立连接 ” -> “ 通话 ” -> “ 释放连接 ”，电路交换的一个重要特点就是: __在通话的全部时间内，通话的两个用户始终占用端到端的通信资源__

<img src='https://github.com/PDKSophia/read-booklist/raw/master/book-image/network/net-4.png' width=600>

### 2.分组交换
分组交换采用的是<strong>“存储转发”</strong>技术，下图中表示将一个报文划分为几个分组在进行传送。通常我们把要发送的整块数据称为一个 __报文__，在发送报文之前，先把较长的报文划分成一个个更小的等长数据段。在每一个数据段前面，加上一些必要的控制信息组成的<strong>首部</strong>， 就构成了一个分组。

分组又称为<strong>“包”</strong>，首部称为包头。每个分组都有首部和尾部，包含了源地址和目的地址等控制信息，在同一个传输线路上同时传输多个分组互相不会影响，因此在同一条传输线路上允许同时传输多个分组，也就是说分组交换不需要占用传输线路。

<img src='https://github.com/PDKSophia/read-booklist/raw/master/book-image/network/net-5.png' width=600>

位于网络边缘的主机和位于网络核心部分的路由器都是计算机，但是他们的作用却不一样。*主机是为用户进行信息处理的，可以和其他主机通过网络交换信息，路由器是用来转发分组的，即进行分组交换的。*

路由器收到一个分组，先暂时存储一下，然后检查其首部，也就是包头，查找转发表，按照首部中的目的地址，找到合适的接口转发走出去，把分组交给下一个路由器，这样一步一步的以存储转发的方式，把分组交付给最终的目的主机。

> 路由器暂时存储的是一个个短分组，而不是整个长报文。短分组是暂时存放在路由器的存储器(内存)中而不是存储在磁盘中。这就保证了较高的交换速率。

采用存储转发的分组交换，实质上是采用了在数据通信的过程中断续分配传输带宽的策略，提高通信线路的利用率。

为了提高分组交换网的可靠性，互联网的核心部分常采用<strong>网状拓扑结构</strong>，使得发送网络拥塞或者少数结点、链路出现鼓掌时，路由器可灵活转变转发路由，而不避免引起通信的中断。

## 计算机网络的类别
### 1. 按照网络的作用范围进行分类
- 广域网WAN

- 城域网MAN

- 局域网LAN

- 个人区域网PAN

### 2. 按照网络的使用者进行分类
- 公用网(public network)

- 专用网(private network)

## 计算机网络的性能
### 速率
网络中的速率指的是`数据的传送速率`，它又称为数据率或比特率。速率的单位是: bit/s。(K=2<sup>10</sup>=1024，M=2<sup>20</sup>，G=2<sup>30</sup>，T=2<sup>40</sup>， ..... )，当提到网络的速率时，往往指的是额定速率或标称速率，而并非网络实际上运行的速率。

### 带宽
带宽本来是指某个信号具有的频带宽度，这种意义的带宽单位是赫。因此，表示某通信道允许通过的信号频带范围就称为该信道的带宽

在计算机网络中，带宽用来表示某通道传输数据的能力。因此网络带宽表示在单位时间内网络中的某信道所能通过的最高数据率。

### 吞吐量
表示在单位时间内通过某个网络的实际的数据量

### 时延
是指数据从网络的一端到另一端所需要的时间。它有时也称为延迟或者迟延

(1) 发送时延 : 主机或路由器发送数据帧所需要的时间，也就是从发送数据帧的第一个比特算起，到该帧的最后一个比特发送完毕所需的时间，计算公式为

<div align='center'>
  <img src='https://github.com/PDKSophia/read-booklist/raw/master/book-image/network/net-6.png' width=400>
</div>

(2) 传播时延 : 电磁波在信道中传播一定的距离需要花费的时间，计算公式为

<div align='center'>
  <img src='https://github.com/PDKSophia/read-booklist/raw/master/book-image/network/net-7.png' width=400>
</div>

(3) 处理时延 : 主机或者路由器收到分组后，要花费一定的时间进行处理，这就是处理时延

(4) 排队时延 : 分组在经过网络传输时，要经过路由器。但是分组在进入路由器后要现在输入队列中排队等待处理。在路由器确定了转发接口之后，还要在输出队列中排队等待转发。排队时延的长短取决于网络当时的通信量。当网络的通信量很大时会发生队列溢出，使分组丢失，这相当于排队时延为无穷大

__总时延 = 发送时延 + 传播时延 + 处理时延 + 排队时延__

<img src='https://github.com/PDKSophia/read-booklist/raw/master/book-image/network/net-8.png' width=600>

### 往返时间RTT

## 计算机网络体系结构
<img src='https://github.com/PDKSophia/read-booklist/raw/master/book-image/network/net-9.png' width=560>

### 五层协议
#### 应用层
通过应用进程间的交互来完成特定网络应用。比如 DNS、HTTP协议、SMTP协议。数据单位为报文。

#### 运输层
为进程提供通用数据传输服务。由于应用层协议很多，定义通用的传输层协议就可以支持不断增多的应用层协议。

运输层包括两种协议：`传输控制协议 TCP`，提供面向连接、可靠的数据传输服务，数据单位为报文段；`用户数据报协议 UDP`，提供无连接、尽最大努力的数据传输服务，数据单位为用户数据报。TCP 主要提供完整性服务，UDP 主要提供及时性服务。

#### 网络层
为分组交换网上的`不同主机`提供数据传输服务。在发送数据时，网络层把运输层产生的报文段或用户数据报封装成`分组`或`包`进行传送。在TCP/IP协议中，由于网络层使用IP协议，因此分组也叫做 `IP数据包`。网络层的另一任务就是 : 选择合适的路由，使源主机运输层传下来的分组，能够通过网络中的路由器找到目的主机。

常见的协议比如 CMP 、 IP 、 ARP等协议

#### 数据链路层
网络层针对的还是主机之间的数据传输服务，而主机之间可以有很多链路，*链路层协议就是为同一链路的主机提供数据传输服务*。数据链路层把网络层传下来的`IP数据包`封装成`帧`，在两个相邻结点间的链路上传送帧。每一帧包括数据和必要的控制信息。硬件地址寻址、差错校验、将比特组合成字节进而组合成帧，用MAC地址访问介质

#### 物理层
考虑的是怎样在传输媒体上传输数据比特流，而不是指具体的传输媒体。物理层的作用是尽可能屏蔽传输媒体和通信手段的差异，使数据链路层感觉不到这些差异。以二进制形式传输数据

### OSI七层协议
其中表示层和会话层用途如下：

- 表示层 ：数据压缩、加密以及数据描述，这使得应用程序不必关心在各台主机中数据内部格式不同的问题。比如HTTP、HTTPS等协议

- 会话层 ：建立及管理会话。比如session、cookie

五层协议没有表示层和会话层，而是将这些功能留给应用程序开发者处理

### 数据在各层之间的传递过程
在向下的过程中，需要添加下层协议所需要的首部或者尾部，而在向上的过程中不断拆开首部和尾部。

路由器只有下面三层协议，因为路由器位于网络核心中，不需要为进程或者应用程序提供服务，因此也就不需要传输层和应用层。

<img src='https://github.com/PDKSophia/read-booklist/raw/master/book-image/network/net-10.png' width=480>

### TCP/IP的体系结构
它只有四层，相当于五层协议中数据链路层和物理层合并为网络接口层。

<img src='https://github.com/PDKSophia/read-booklist/raw/master/book-image/network/net-11.png' width=480>

TCP/IP 体系结构不严格遵循 OSI 分层概念，应用层可能会直接使用 IP 层或者网络接口层。

<img src='https://github.com/PDKSophia/read-booklist/raw/master/book-image/network/net-12.png' width=480>


还有一种方法，就是分层次画出具体的协议来表示TCP/IP协议族，它的特点是 : 一种沙漏形状，中间小两边大，IP 协议在其中占据举足轻重的地位。

<img src='https://github.com/PDKSophia/read-booklist/raw/master/book-image/network/net-13.png' width=480>

--------

# 二、物理层
## 物理层任务
物理层的作用及任务就是 : 尽可能地屏蔽掉传输媒体和通信手段的差异，使物理层上面的数据链路层感觉不到这种差异，这样就能使得数据链路层只需要考虑如何完成本层的协议和服务，不需要考虑网路具体的传输媒体和通信手段。

## 通信方式
首先，我们先理解一些常用术语，通信的目的是传送信息，数据是运送信息的实体，在RFC 4949中给出的定义，数据是使用特定方式表示的信息，通常是有意义的符号序列。信号则是数据的电气或电磁的表现。

信号分为两大类
- 模拟信号——代表信息的参数的取值是连续的。

- 数字信号——代表信息的参数的取值是离散的。

从通信的双方信息交互的方式来看，有三种基本方式: 

- 单向通信 : 又称为`单工通信`，只有一个方向的通信而没有反方向的交互，比如无线电广播或有线电广播

- 双向交替通信 : 又称为`半双工通信`，通信的双方都可以发送信息，但是不能双方同时发送，当然也不能同时接收

- 双向同时通信 : 又称为`全双工通信`，通信的双方可以同时发送和接收信息

来自信源的信号常称为 `基带信号`，基带信号往往包含有较多的低频成分，甚至有直流成分，而很多信道不能传输这种低频或者直流，所以我们要进行<strong>调制</strong>

基带信号调制分两大类， __基带调制__ 和 __带通调制__
### 基带调制
仅仅对基带信号的波形进行变换，使它能够与信道特性相适应。转变后的信号仍是基带信号，这种基带调制一般是把`数字信号`转换成另一种数字信号，所以这个过程常常被称为`编码`。（数字信号 - 数字信号）

<div align='center'>
  <img src='https://github.com/PDKSophia/read-booklist/raw/master/book-image/network/net-14.png' width=400>
</div>

### 带通调制
使用`载波`进行调制，把基带信号的频率范围搬移到较高的频段，并转换为`模拟信号`。（数字信号 - 模拟信号）

最基本的带通调制方法有 : 调幅、调频和调相，复杂点的就正交振幅调制

<div align='center'>
  <img src='https://github.com/PDKSophia/read-booklist/raw/master/book-image/network/net-15.png' width=400>
</div>

## 信道复用技术
### 1.频分复用
频分复用的所有用户在相同的时间占用不同的频率带宽资源。

<div align='center'>
  <img src='https://github.com/PDKSophia/read-booklist/raw/master/book-image/network/net-16.png' width=400>
</div>

### 2.时分复用
时分复用的所有用户在不同的时间占用相同的频率带宽资源。

<div align='center'>
  <img src='https://github.com/PDKSophia/read-booklist/raw/master/book-image/network/net-17.png' width=400>
</div>

使用频分复用和时分复用进行通信，在通信的过程中主机会一直占用一部分信道资源。但是由于计算机数据的突发性质，通信过程没必要一直占用信道资源而不让出给其它用户使用，因此这两种方式对信道的利用率都不高。

### 3.统计时分复用
是对时分复用的一种改进，不固定每个用户在时分复用帧中的位置，只要有数据就集中起来组成统计时分复用帧然后发送。
<div align='center'>
  <img src='https://github.com/PDKSophia/read-booklist/raw/master/book-image/network/net-18.png' width=400>
</div>

### 4.波分复用
光的频分复用。由于光的频率很高，因此习惯上用波长而不是频率来表示所使用的光载波。
<div align='center'>
  <img src='https://github.com/PDKSophia/read-booklist/raw/master/book-image/network/net-19.png' width=660>
</div>

### 5.码分复用
又称为 : `码分多址CDMA`。在CDMA中，每一个比特时间再划分为m个短的间隔，称为`码片`，通常m的值是64或128。

使用CDMA的每一个站被指派一个唯一的 m bit 码片序列，一个站如果要发送比特1，那么就发送自己的 m bit 码片序列。如果要发送比特0，就发送该码片序列的二进制反码。例如，指派给S站的 8 bit码片序列是 00011011，那么当S发送比特1时，它就发送序列00011011，如果S发送比特0时，就发送11100100

<div align='center'>
  <img src='https://github.com/PDKSophia/read-booklist/raw/master/book-image/network/net-20.png' width=660>
</div>

---------

# 三、数据链路层
## 信道分类
我们先明确一个概念，“链路” 和 “数据链路” 并不是一回事。链路是从一个结点到相邻结点的一段物理线路。数据链路是除了必须有一条物理线路外，还必须有一些必要的通信协议来控制这些数据的传输。常用的方法是使用`网络适配器`来实现这些协议。

### 1. 点对点信道
一对一通信。

因为不会发生碰撞，因此也比较简单，使用[PPP协议](#PPP协议)进行控制。

### 2. 广播信道
一对多通信，一个节点发送的数据能够被广播信道上所有的节点接收到。

所有的节点都在同一个广播信道上发送数据，因此需要有专门的控制方法进行协调，避免发生冲突（冲突也叫碰撞）。

主要有两种控制方法进行协调，一个是使用[信道复用技术](#信道复用技术)，一是使用 [CSMA/CD协议](#CSMA/CD协议)。

## 三个基本问题
数据链路层协议有很多种，但是有三个基本问题是共同的 : 封装成帧、透明传输、差错检测

### 封装成帧
`封装成帧`就是在一段数据的前后分别添加首部和尾部，接收端在收到物理层上交的比特流后，就能根据首部和尾部的标记，从收到的比特流中识别帧的开始和结束。

一个帧的长度等于帧的数据部分长度加上帧首部和帧尾部的长度。首部和尾部的一个重要作用是进行帧定界。每一种链路层协议都规定了所能传送的帧的数据部分长度上线——最大传送单元MTU(默认值1500字节)

<div align='center'>
  <img src='https://github.com/PDKSophia/read-booklist/raw/master/book-image/network/net-21.png' width=600>
</div>

如果数据是又可打印的ASCII码组成的文本文件时，帧定界可以使用特殊的`帧定界符`，SOH放在一帧的最前面，表示帧的首部开始。EOT表示帧的结束。他们都是十六进制，编码分别是01(二进制00000001)和04(二进制00000100)

在数据传输中出现差错时，帧定界符作用更加明显。比如发送端在发送一个帧时突然出故障，中断了发送。但是很快又恢复正常，于是从头开始发送刚才未发送完的帧。于是使用了`帧定界符`，接收端就能知道前面收到的数据是个不完整的帧。

### 透明传输
帧的开始和结束都是通过使用专门指明的控制字符，如SOH和EOT等。当传送的是用文本文件组成的帧时，不管从键盘输入什么字符都可以放在这样的帧中传输过去，因此这样的传输是`透明传输`

但是！！！如果数据部分是非ACSII码的文本文件时（二进制的图像)，如果数据中的某个字节的二进制码刚好是 SOH 或 EOT 这种控制字符一样，那么，数据链路层就会错误地认为“找到帧的边界”，误认为是一个“完整的帧”，而把剩下的部分数据丢弃。

<div align='center'>
  <img src='https://github.com/PDKSophia/read-booklist/raw/master/book-image/network/net-22.png' width=600>
</div>

透明 ： 它表示某个实际存在的事物看起来却好像不存在一样。

为了解决透明传输问题，使用一种方法叫做`字节填充`或称为`字符填充`。具体方法是 : 发送端的数据链路层在数据中出现控制字符“SOH”或“EOT”的前面插入一个`转义字符“ESC”`。而在接收端的数据链路层接收到数据后，在送往网络层之前删除这个插入的转义字符。

<div align='left'>
  <img src='https://github.com/PDKSophia/read-booklist/raw/master/book-image/network/net-23.png' width=600>
</div>

### 差错检测
比特在传输过程中可能会出现差错 : 1 可能变为了 0， 而 0 可能变成了 1，这就叫做`比特差错`。

为了保证数据传输的可靠性，在计算机网络传输数据时，必须采用各种差错检测措施。目前在数据链路层广泛使用了`循环冗余检验CRC`的检错技术。

CRC运算就是在数据M的后面添加供差错检测用的n位冗余码，这种为了进行检错而添加的冗余码常被称为`帧检验序列FCS`

> CRC是一种检错方法，FCS是添加在数据后面的冗余码

## PPP协议
互联网用户通常需要连接到某个 ISP 之后才能接入到互联网，PPP 协议是用户计算机和 ISP 进行通信时所使用的数据链路层协议。

<div align='center'>
  <img src='https://github.com/PDKSophia/read-booklist/raw/master/book-image/network/net-24.png' width=600>
</div>

### PPP协议组成
- 一个将IP数据报封装成串行链路的方法

- 一个用来建立、配置和测试数据链路连接的链路控制协议LCP

- 一套网络控制协议NCP

### PPP协议的帧格式

<div align='left'>
  <img src='https://github.com/PDKSophia/read-booklist/raw/master/book-image/network/net-25.png' width=660>
</div>

### 各字段意义

- F字段为帧的定界符，规定为 0x7E（二进制01111110）， '0x'表示它后面的字符是用十六进制表示的。如果连续出现两个标志字段，就表示这是一个空帧，应当丢弃

- A 和 C 字段暂时没有意义

- FCS 字段是使用 CRC 的检验序列

- 信息部分长度可变，但长度不超过 1500

### 零比特填充
PPP协议在使用SONET/SDH链路时，使用同步传输，在这种情况下，使用`零比特填充`方法来实现透明传输。

具体做法是 : 在发送端，扫描整个信息字段，只要发现有5个连续的1，就立即填入一个0。就可以保证信息字段中不会出现6个1；在接收端收到一个帧时，先找到标志字段F来确定一个帧的边界，然后扫描信息部分，每当发现5个连续1时，就把5个1后面的0删除，还原成原来的信息比特流。这就保证了透明传输

<div align='left'>
  <img src='https://github.com/PDKSophia/read-booklist/raw/master/book-image/network/net-26.png' width=600>
</div>

### PPP协议的工作状态

<div align='left'>
  <img src='https://github.com/PDKSophia/read-booklist/raw/master/book-image/network/net-27.png' width=600>
</div>

PPP链路的起始和终止状态永远都是 `链路静止` 状态，这时在用户个人电脑和ISP的路由器之间并不存在物理层的链接

当用户个人电脑通过`调制解调器`呼叫路由器时 (通常是屏幕上用鼠标点击一个连接按钮)，`路由器`就能检测到`调制解调器`发出的载波信号。在双方建立了物理层连接后，PPP就进入了 `链路建立` 状态，其目的是建立链路层的LCP连接

这时链路控制协议LCP开始协商一些配置选项，即发送`LCP配置请求帧`。协商结束后双方建立了LCP链路，进入到 `鉴别` 状态。在这一状态，__只允许传送LCCP协议的分组、鉴别协议的分组和检测链路质量的分组__。如果使用`PAP密码认证协议`，则需要发起通信的一方发送身份标识和口令。如果需要更好的安全性，则可使用更加复杂的`CHAP询问握手认证协议(三次握手)`。鉴别失败，进入 `链路终止` 状态，如果鉴别成功，进入 `网路层协议` 状态。

在 “网络层协议” 状态，PPP链路两端的网络控制协议NCP根据网络层的不同协议相互交换网络层特定的网络控制分组。

当网络层配完毕后，链路进入可进行数据通信的 `链路打开` 状态。链路的两个PPP端点可以批次向对方发送分组

数据传输结束后，链路的一端发出`终止请求LCP分组`请求终止链路连接，在收到对方发来的`终止确认LCP分组`后，转到 `链路终止` 状态。如果链路出现故障，也会从 “链路打开” 状态转到 “链路终止” 状态。

当调制解调器的载波停止时，回到 `链路静止` 状态

----------

# 参考资料
CS-Notes : https://github.com/CyC2018/CS-Notes/blob/master/notes/计算机网络.md
